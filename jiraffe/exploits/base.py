#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from abc import ABC, abstractmethod
from jiraffe.enums import Severity
from jiraffe.style import Style
from jiraffe.recon import uparse


class Exploit(ABC):
    cve: str
    severity: Severity
    description: str

    def __init__(self, client, target, verbose=False, check_only=False):
        self.client = client
        self.target = uparse(target).rstrip("/")
        self.verbose = verbose
        self.check_only = check_only

    def banner(self):
        print(
            Style.YELLOW(
                f"[*] Launching {self.cve} [{self.severity.value}]"
            )
        )

    @abstractmethod
    def check(self) -> bool:
        """Return True if target appears vulnerable"""
        pass

    @abstractmethod
    def exploit(self):
        pass

    def run(self) -> bool:
        self.banner()

        vulnerable = self.check()

        if not vulnerable:
            print("[-] Not vulnerable")
            return False

        print("[+] Vulnerable")

        if not self.check_only:
            self.exploit()

        return True
