#!/usr/bin/env python3
# -*- coding: utf-8 -*-

from abc import ABC, abstractmethod
from jiraffe.enums import Severity
from jiraffe.style import Style
from jiraffe.common import uparse
from jiraffe.common import color_severity


class Exploit(ABC):
    cve: str
    severity: Severity
    description: str

    def __init__(self, client, target, verbose=False, check_only=False):
        self.client = client
        self.target = uparse(target).rstrip("/")
        self.verbose = verbose
        self.check_only = check_only

    def banner(self) -> None:
        severity_color = color_severity(self.severity.value)
        print(
            f"{Style.YELLOW(f'[*] Launching')} "
            f"{Style.RESET(self.cve)} "
            f"[{severity_color(self.severity.value):<8}]"
        )

    @abstractmethod
    def check(self) -> bool:
        """Return True if target appears vulnerable"""
        pass

    @abstractmethod
    def exploit(self) -> None:
        pass

    def run(self) -> bool:
        self.banner()

        vulnerable = self.check()

        if not vulnerable:
            print("[-] Not vulnerable")
            return False

        print("[+] Vulnerable")

        if not self.check_only:
            self.exploit()

        return True
